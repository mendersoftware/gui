{"version":3,"sources":["../src/Collapse.js"],"names":["PRECISION","stringHeight","Math","max","parseFloat","height","toFixed","Collapse","props","onHeightReady","isOpened","renderStatic","setState","reportHeight","state","isOpenedChanged","report","springConfig","fixedHeight","newHeight","skipAnimation","springHeight","precision","instantHeight","_springConfig","_onHeightReady","_onRest","onRest","style","children","keepCollapsedContent","newStyle","overflow","getMotionHeight","renderFixed","currentStringHeight","content","st","Component","defaultProps"],"mappings":"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","file":"Collapse.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport {Motion, spring} from 'react-motion';\nimport HeightReporter from 'react-height';\n\n\nconst PRECISION = 0.5;\n\n\nconst stringHeight = height => Math.max(0, parseFloat(height)).toFixed(1);\n\n\nexport default class Collapse extends React.Component {\n  static propTypes = {\n    isOpened: PropTypes.bool.isRequired,\n    children: PropTypes.node.isRequired,\n    fixedHeight: PropTypes.number,\n    style: PropTypes.object, // eslint-disable-line react/forbid-prop-types\n    springConfig: PropTypes.objectOf(PropTypes.number),\n    keepCollapsedContent: PropTypes.bool,\n    onRest: PropTypes.func,\n    onHeightReady: PropTypes.func\n  };\n\n\n  static defaultProps = {\n    fixedHeight: -1,\n    style: {},\n    keepCollapsedContent: false,\n    onHeightReady: () => {} // eslint-disable-line no-empty-function\n  };\n\n\n  constructor(props) {\n    super(props);\n    this.state = {height: -1, isOpenedChanged: false};\n  }\n\n\n  componentWillMount() {\n    this.height = stringHeight(0);\n    this.renderStatic = true;\n  }\n\n\n  componentWillReceiveProps({isOpened}) {\n    this.setState({isOpenedChanged: isOpened !== this.props.isOpened});\n  }\n\n\n  componentDidUpdate({isOpened}) {\n    if (isOpened !== this.props.isOpened) {\n      const report = this.props.isOpened ? this.state.height : 0;\n\n      this.props.onHeightReady(report);\n    }\n  }\n\n\n  onHeightReady = height => {\n    const {isOpened, onHeightReady} = this.props;\n\n    if (this.renderStatic && isOpened) {\n      this.height = stringHeight(height);\n    }\n\n    this.setState({height: isOpened || !this.renderStatic ? height : 0});\n\n    const reportHeight = isOpened ? height : 0;\n\n    if (this.state.height !== reportHeight) {\n      onHeightReady(reportHeight);\n    }\n  };\n\n\n  getMotionHeight(height) {\n    const {isOpened, springConfig, fixedHeight} = this.props;\n    const {isOpenedChanged} = this.state;\n\n    const newHeight = isOpened ? Math.max(0, parseFloat(height)).toFixed(1) : stringHeight(0);\n\n    // No need to animate if content is closed and it was closed previously\n    // Also no need to animate if height did not change\n    const skipAnimation = !isOpenedChanged && !isOpened ||\n      this.height === newHeight && fixedHeight === -1;\n\n    const springHeight = spring(isOpened ? Math.max(0, height) : 0, {\n      precision: PRECISION,\n      ...springConfig\n    });\n    const instantHeight = isOpened ? Math.max(0, height) : 0;\n\n    return skipAnimation ? instantHeight : springHeight;\n  }\n\n\n  renderFixed() {\n    const {\n      springConfig: _springConfig,\n      onHeightReady: _onHeightReady,\n      onRest: _onRest,\n      isOpened,\n      style,\n      children,\n      fixedHeight,\n      keepCollapsedContent,\n      ...props\n    } = this.props;\n\n    if (this.renderStatic) {\n      this.renderStatic = false;\n      const newStyle = {overflow: 'hidden', height: isOpened ? fixedHeight : 0};\n\n      if (!keepCollapsedContent && !isOpened) {\n        return null;\n      }\n      this.height = stringHeight(fixedHeight);\n      return <div style={{...newStyle, ...style}} {...props}>{children}</div>;\n    }\n\n    return (\n      <Motion\n        defaultStyle={{height: isOpened ? 0 : fixedHeight}}\n        style={{height: this.getMotionHeight(fixedHeight)}}>\n        {({height}) => {\n          this.height = stringHeight(height);\n\n          // TODO: this should be done using onEnd from ReactMotion, which is not yet implemented\n          // See https://github.com/chenglou/react-motion/issues/235\n          if (!keepCollapsedContent && !isOpened && this.height === stringHeight(0)) {\n            return null;\n          }\n\n          const newStyle = {overflow: 'hidden', height};\n\n          return <div style={{...newStyle, ...style}} {...props}>{children}</div>;\n        }}\n      </Motion>\n    );\n  }\n\n\n  render() {\n    const {\n      springConfig: _springConfig,\n      onHeightReady: _onHeightReady,\n      isOpened,\n      style,\n      children,\n      fixedHeight,\n      keepCollapsedContent,\n      onRest,\n      ...props\n    } = this.props;\n\n    if (fixedHeight > -1) {\n      return this.renderFixed();\n    }\n\n    const renderStatic = this.renderStatic;\n    const {height} = this.state;\n    const currentStringHeight = parseFloat(height).toFixed(1);\n\n    if (height > -1 && renderStatic) {\n      this.renderStatic = false;\n    }\n\n    // Cache Content so it is not re-rendered on each animation step\n    const content = <HeightReporter onHeightReady={this.onHeightReady}>{children}</HeightReporter>;\n\n    if (renderStatic) {\n      const newStyle = isOpened ? {height: 'auto'} : {overflow: 'hidden', height: 0};\n\n      if (!isOpened && height > -1) {\n        if (!keepCollapsedContent) {\n          return null;\n        }\n\n        return (\n          <div style={{height: 0, overflow: 'hidden', ...style}} {...props}>\n            {content}\n          </div>\n        );\n      }\n\n      // <Motion> to prevent loosing input after causing this component to rerender\n      return (\n        <Motion\n          defaultStyle={{height: Math.max(0, height)}}\n          style={{height: Math.max(0, height)}}\n          onRest={onRest}>\n          {() =>\n            <div style={{...newStyle, ...style}} {...props}>{content}</div>\n          }\n        </Motion>\n      );\n    }\n\n    return (\n      <Motion\n        defaultStyle={{height: Math.max(0, height)}}\n        onRest={onRest}\n        style={{height: this.getMotionHeight(height)}}>\n        {st => {\n          this.height = stringHeight(st.height);\n\n          // TODO: this should be done using onEnd from ReactMotion, which is not yet implemented\n          // See https://github.com/chenglou/react-motion/issues/235\n          if (!isOpened && this.height === '0.0') {\n            if (!keepCollapsedContent) {\n              return null;\n            }\n            return (\n              <div style={{height: 0, overflow: 'hidden', ...style}} {...props}>{content}</div>\n            );\n          }\n\n          const newStyle = isOpened && this.height === currentStringHeight ? {height: 'auto'} : {\n            height: st.height, overflow: 'hidden'\n          };\n\n          return <div style={{...newStyle, ...style}} {...props}>{content}</div>;\n        }}\n      </Motion>\n    );\n  }\n}\n"]}